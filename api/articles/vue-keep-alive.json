{"title":"ã€vueã€‘3.0 keep-aliveå®ç°åŠ¨æ€ç¼“å­˜ä»¥åŠç¼“å­˜é”€æ¯","slug":"vue-keep-alive","date":"2020-01-19T16:00:00.000Z","updated":"2022-10-19T14:40:00.272Z","comments":true,"path":"api/articles/vue-keep-alive.json","realPath":"/2020/vue-keep-alive/index/","excerpt":null,"covers":["/img/2020/01/vue/15794851288763.png"],"cover":"/img/2020/01/vue/15794851288763.png","content":"<h2 id=\"æ¦‚å¿µ\"><a href=\"#æ¦‚å¿µ\" class=\"headerlink\" title=\"æ¦‚å¿µ\"></a>æ¦‚å¿µ</h2><ul>\n<li><code>keep-alive</code><ul>\n<li><code>keep-alive</code>åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚å’Œ<code>transition</code>ç›¸ä¼¼ï¼Œ<code>keep-alive</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª<code>DOM</code>å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ã€‚</li>\n<li><a href=\"https://cn.vuejs.org/v2/api/#keep-alive\">keep-alive: vueæ–‡æ¡£</a></li>\n</ul>\n</li>\n<li>ç»„ä»¶å†…çš„å®ˆå«-<code>beforeRouteLeave</code><ul>\n<li>å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</li>\n<li>å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹<code>this</code></li>\n<li><a href=\"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E7%BB%84%E4%BB%B6%E5%86%85%E7%9A%84%E5%AE%88%E5%8D%AB\">ç»„ä»¶å†…çš„å®ˆå«:<code>vue-router</code>æ–‡æ¡£</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå·¦ä¾§ä¸ºåŠŸèƒ½èœå•æ ï¼Œç‚¹å‡»èœå•åˆ—è¡¨ï¼Œå³ä¾§æ˜¾ç¤ºè¯¥èœå•çš„åŠŸèƒ½é¡µé¢ï¼Œæœ¬æ¥æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åå°ç®¡ç†ç³»ç»Ÿå¸ƒå±€ï¼Œç°åœ¨å¢åŠ äº†tabsèœå•æŒ‰é’®ï¼›<br>ç‚¹å‡»å·¦ä¾§èœå•æ æ—¶ï¼Œå³ä¾§é¡µé¢å¤´éƒ¨headeræ˜¾ç¤ºå½“å‰çš„é¡µé¢æ ‡é¢˜ï¼Œå½¢æˆä¸€ä¸ªtabsåˆ—è¡¨ï¼Œç‚¹å‡»å¯åˆ‡æ¢é¡µé¢å†…å®¹å’Œå…³é—­tabï¼›<br>ç°åœ¨çš„éœ€æ±‚ï¼š<br>  æ‰“å¼€ä¹‹åéœ€è¦ä¿ç•™çš„é¡µé¢åœ¨tabä¸å…³é—­çš„æƒ…å†µä¸‹ï¼Œä¿ç•™ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œè€Œåœ¨tabå…³é—­ä¹‹åï¼Œåˆ™ä¸‹æ¬¡æ‰“å¼€ä¼šé‡æ–°è¯·æ±‚æ•°æ®ï¼Œä¸ä¼šä¿ç•™ä¸Šæ¬¡çŠ¶æ€ã€‚</p>\n<p>  <img src=\"/img/2020/01/vue/15794851288763.png\"></p>\n<h2 id=\"åˆæ­¥è§£å†³\"><a href=\"#åˆæ­¥è§£å†³\" class=\"headerlink\" title=\"åˆæ­¥è§£å†³\"></a>åˆæ­¥è§£å†³</h2><p>ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨vueçš„åŠŸèƒ½ç»„ä»¶</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;keep-alive&gt;</span><br><span class=\"line\">    &lt;router-view /&gt;</span><br><span class=\"line\">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>\n<p>ä½†æ˜¯è¿™ç§æƒ…å†µåªèƒ½å®ç°ç¼“å­˜æ‰€æœ‰é¡µé¢ï¼Œå°±æ˜¯ä¸èƒ½æ ¹æ®éœ€æ±‚å®ç°åŠ¨æ€ç¼“å­˜ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½å­˜ç€å‘¢ï¼Œæ„å•Šã€‚</p>\n<h2 id=\"è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\"><a href=\"#è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\"></a>è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š</h2><blockquote>\n<p>è·¯ç”±å…ƒä¿¡æ¯å†…æ·»åŠ ç‰¹å®šå­—æ®µå¦‚ï¼š<code>keepAlive</code></p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const router = new VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: &#x27;/foo&#x27;,</span><br><span class=\"line\">      component: Foo,</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: &#x27;bar&#x27;,</span><br><span class=\"line\">          component: Bar,</span><br><span class=\"line\">          // a meta field</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            keepAlive: true</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>çˆ¶ç»„ä»¶å†…æ ¹æ®è·¯ç”±ä¸­çš„<code>keepAlive</code>å­—æ®µåŠ¨æ€ä½¿ç”¨<code>keep-alive</code>æ ‡ç­¾</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Vue</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    get keepAlive () &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–å½“å‰è·¯ç”±çš„å…ƒä¿¡æ¯ä¸­çš„keepAliveå­—æ®µ</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">meta</span>.<span class=\"property\">keepAlive</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private render () &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            !this.keepAlive &amp;&amp; <span class=\"tag\">&lt;<span class=\"name\">router-view</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">keep-alive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.keepAlive &amp;&amp; <span class=\"tag\">&lt;<span class=\"name\">router-view</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Home</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h2><p>ç”±äºç°åœ¨ç»„ä»¶çš„<code>keep-alive</code>æ˜¯åŠ¨æ€æ ¹æ®è·¯ç”±å…ƒä¿¡æ¯ä¸­çš„<code>keepAlive</code>å­—æ®µè¿›è¡ŒåŠ¨æ€ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åªè¦åŠ¨æ€æ”¹å˜å¯¹åº”è·¯ç”±å…ƒä¿¡æ¯çš„<code>keepAlive</code>å­—æ®µå°±å¯ä»¥å®ç°åŠ¨æ€ç¼“å­˜ã€‚</p>\n<h2 id=\"å®ç°æ–¹æ¡ˆ\"><a href=\"#å®ç°æ–¹æ¡ˆ\" class=\"headerlink\" title=\"å®ç°æ–¹æ¡ˆ\"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id=\"æ–¹æ¡ˆä¸€\"><a href=\"#æ–¹æ¡ˆä¸€\" class=\"headerlink\" title=\"æ–¹æ¡ˆä¸€\"></a>æ–¹æ¡ˆä¸€</h3><p>åˆ©ç”¨<code>beforeRouteLeave</code>æ”¹å˜<code>from</code>çš„<code>keepAlive</code>å®ç°ï¼ˆåŸæ€è·¯ï¼Œç½‘ç»œè§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œæœ‰bugï¼‰</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteLeave (to: any, from: any, next: any) &#123;</span><br><span class=\"line\">  // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</span><br><span class=\"line\">  // åˆ¤æ–­æ˜¯å¦æ˜¯å»å¾€é¡µé¢ C</span><br><span class=\"line\">  if (to.name !== &#x27;C&#x27;) &#123;</span><br><span class=\"line\">    // ä¸æ˜¯å» C é¡µé¢ï¼Œä¸ç¼“å­˜</span><br><span class=\"line\">    from.meta.keepAlive = false</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    // æ˜¯å» C é¡µé¢ï¼Œç¼“å­˜</span><br><span class=\"line\">    from.meta.keepAlive = true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  next()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>bugï¼šé¦–æ¬¡å»Cé¡µé¢ï¼Œå†è¿”å›Bé¡µé¢ï¼ŒBå¹¶æ²¡æœ‰ç¼“å­˜ï¼Œç¬¬äºŒæ¬¡å†è¿›å…¥Cé¡µé¢ï¼ŒBé¡µé¢ç¼“å­˜ï¼Œä¸”è¿›Aé¡µé¢å¹¶ä¸èƒ½æ¸…é™¤Bé¡µé¢çš„ç¼“å­˜</p>\n</blockquote>\n<h3 id=\"æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"><a href=\"#æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"></a>æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰</h3><p><code>$destroy()</code>é”€æ¯</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteLeave (to: any, from: any, next: any) &#123;</span><br><span class=\"line\">  // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</span><br><span class=\"line\">  // åˆ¤æ–­æ˜¯å¦æ˜¯å»å¾€é¡µé¢ C</span><br><span class=\"line\">  if (to.name !== &#x27;C&#x27;) &#123;</span><br><span class=\"line\">    // ä¸æ˜¯å» C é¡µé¢ï¼Œä¸ç¼“å­˜</span><br><span class=\"line\">    this.$destroy()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  next()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>bugï¼šé”€æ¯ä¹‹åæ°¸è¿œä¸ä¼šè¢«ç¼“å­˜</p>\n</blockquote>\n<h3 id=\"æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"><a href=\"#æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"></a>æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰</h3><ul>\n<li>æ ¹æ®æºç çœ‹æ¥ç¼“å­˜çš„ç»„ä»¶éƒ½ä¼šè®¾ç½®ä¸€ä¸ªcacheå±æ€§ï¼Œå¯ä»¥é€šè¿‡ä»£ç å¼ºè¡Œç§»é™¤æ‰ã€‚ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰å½»åº•é”€æ¯ä¾æ—§å å†…å­˜</li>\n<li><a href=\"https://segmentfault.com/a/1190000015845117\">å…·ä½“å®ç°å‚è€ƒ</a></li>\n</ul>\n<h3 id=\"æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\"><a href=\"#æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\"></a>æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰</h3><p>åˆ©ç”¨<code>keep-alive</code>çš„<code>include</code>å±æ€§ï¼Œåˆ©ç”¨<code>vuex</code>åŠ¨æ€æ§åˆ¶<code>include</code>è¾¾åˆ°åŠ¨æ€ç®¡ç†ç¼“å­˜</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;keep-alive :include=&quot;keepAliveList&quot;&gt;</span><br><span class=\"line\">    &lt;router-view :key=&quot;$route.fullPath&quot;/&gt;</span><br><span class=\"line\">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>\n\n<p>åˆ©ç”¨è®¡ç®—å±æ€§å’Œvuexè·å–ç¼“å­˜åˆ—è¡¨</p>\n<blockquote>\n<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„è§„åˆ™ï¼ŒåŸå› è¯·ç»§ç»­å¾€ä¸‹çœ‹</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--vuex--&gt;</span><br><span class=\"line\">state: &#123;</span><br><span class=\"line\">    keepAliveList:&#x27;&#x27;,//ä¿å­˜ç¼“å­˜çš„åˆ—è¡¨</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">mutations: &#123;</span><br><span class=\"line\">    setKeepAliveLists(state,arrListString)&#123;</span><br><span class=\"line\">        state.keepAliveList = arrListString;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--è§†å›¾ç»„ä»¶ä¸­--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">computed:&#123;</span><br><span class=\"line\">    keepAliveList()&#123;</span><br><span class=\"line\">        // è·å–ç¼“å­˜çš„è·¯ç”±åˆ—è¡¨</span><br><span class=\"line\">        return this.$store.state.keepAliveList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”Ÿæˆç¼“å­˜åˆ—è¡¨ï¼Œåˆ—è¡¨çš„å€¼ä¸ºå„ç»„ä»¶ä¸­nameçš„å€¼é›†åˆæ‹¼æ¥çš„å­—ç¬¦ä¸²</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.$store.commit(&#x27;setKeepAliveLists&#x27;,routerComponentNameList.join())</span><br></pre></td></tr></table></figure>\n\n<p>ç‚¹å‡»å·¦ä¾§èœå•æ æ—¶ï¼Œæ›´æ–°ç¼“å­˜åˆ—è¡¨</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ç‚¹å‡»å·¦ä¾§èœå•çš„äº‹ä»¶å‡½æ•° --&gt;</span><br><span class=\"line\">handleSelect(name) &#123;</span><br><span class=\"line\">    if(this.routerNameMap.has(name))&#123;//å¦‚æœå½“å‰ç‚¹å‡»çš„è·¯ç”±å·²ç»åœ¨ç¼“å­˜åˆ—è¡¨ä¸­ï¼Œåˆ™å…ˆæ¸…é™¤ç¼“å­˜åˆ—è¡¨ï¼Œå†æ·»åŠ ï¼›</span><br><span class=\"line\">        this.resetKeepAive(name,this.keepAliveList);//åˆ é™¤ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">        this.tabChangeRoute(name);//åˆ‡æ¢è·¯ç”±</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        this.routerNameMap.add(name)</span><br><span class=\"line\">        this.tabChangeRoute(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">// æ›´æ–°è¦ç¼“å­˜çš„è·¯ç”±åˆ—è¡¨</span><br><span class=\"line\">resetKeepAive(name,cacheList) &#123;</span><br><span class=\"line\">    const conf = this.keepAliveList;</span><br><span class=\"line\">    let arr = cacheList.split(&#x27;,&#x27;);</span><br><span class=\"line\">    if (name &amp;&amp; typeof name === &#x27;string&#x27;) &#123;</span><br><span class=\"line\">        let i = arr.indexOf(name);</span><br><span class=\"line\">        if (i &gt; -1) &#123;</span><br><span class=\"line\">            arr.splice(i, 1);</span><br><span class=\"line\">            this.$store.commit(&#x27;setKeepAliveLists&#x27;,arr.join());</span><br><span class=\"line\">            this.$nextTick(() =&gt; &#123;//æ·»åŠ ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">                this.$store.commit(&#x27;setKeepAliveLists&#x27;,conf);</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç‚¹å‡»å³ä¾§tabså…³é—­æ ‡ç­¾åˆ é™¤ç¼“å­˜</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">removeTab(name)&#123;</span><br><span class=\"line\">    // ç‚¹å‡»tabä¸Šçš„å…³é—­æŒ‰é’®ï¼Œæ¸…é™¤å½“å‰è·¯ç”±çš„ç¼“å­˜</span><br><span class=\"line\">    this.routerNameMap.delete(name);</span><br><span class=\"line\">    this.resetKeepAive(name,this.keepAliveList);//åˆ é™¤ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸‹é¢ä¸ºä¸»è¦ä»£ç ï¼Œç›‘å¬å½“å‰è·¯ç”±æ˜¯å¦è¢«ç§»é™¤ç¼“å­˜ï¼Œå¦‚æœç§»é™¤ç¼“å­˜åˆ™éœ€è¦é”€æ¯è¯¥ç»„ä»¶ï¼Œå¦åˆ™å†…å®¹ä¸­çš„ç¼“å­˜ç»„ä»¶ä¼šè¶Šæ¥è¶Šæ¥ï¼Œå½±å“ä½¿ç”¨æ€§èƒ½ï¼›<br>åˆ›å»ºä¸€ä¸ª<code>mixin.js</code>æ–‡ä»¶ï¼Œç„¶åå¼•å…¥åˆ°éœ€è¦è¢«åŠ¨æ€ç¼“å­˜çš„è·¯ç”±ç»„ä»¶ä¸­å³å¯ï¼›</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// è·¯ç”±ç¼“å­˜ç®¡ç†</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\">        keepAliveConf()&#123;</span><br><span class=\"line\">            return this.$store.state.keepAliveList;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    watch:&#123;</span><br><span class=\"line\">        keepAliveConf(e)&#123;</span><br><span class=\"line\">            // ç›‘å¬ç¼“å­˜åˆ—è¡¨çš„å˜åŒ–ï¼Œå¦‚æœç¼“å­˜åˆ—è¡¨ä¸­æ²¡æœ‰å½“å‰çš„è·¯ç”±æˆ–ç»„ä»¶åˆ™åœ¨ç¼“å­˜ä¸­é”€æ¯è¯¥å®ä¾‹</span><br><span class=\"line\">            let name = this.$options.name;</span><br><span class=\"line\">            if(!e.split(&#x27;,&#x27;).includes(name)) &#123;</span><br><span class=\"line\">                this.$destroy()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å…³äºåœ¨<code>$store</code>ä¸­ä¿å­˜å’Œåˆ é™¤çš„è¿‡ç¨‹ï¼Œå„äººæœ‰å„äººçš„æ–¹æ³•ï¼Œæˆ‘è¿™è¾¹åªæ˜¯ä¸€ç§å‚è€ƒï¼Œä¸è¿‡å¤šè®¨è®ºã€‚</p>\n<p>ä¸è¿‡å…³äº<code>keep-alive</code>çš„<code>include</code>åŸç†ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹ï¼Œå®˜æ–¹(æˆªæ­¢åˆ°2020å¹´1æœˆ)ç»™çš„æ–¹æ¡ˆæ˜¯æ­£åˆ™ç™½åå•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨<code>include</code>ä¸­åŒ…å«çš„å­—æ®µï¼Œåªè¦è·¯ç”±çš„<code>name</code>æ»¡è¶³æ­£åˆ™è¦æ±‚ï¼Œåˆ™ä¼šç¼“å­˜ï¼Œ<code>exclude</code>çš„è§„åˆ™åŒæ ·æ»¡è¶³ï¼Œæ‰€ä»¥è¿™å°±é€ æˆåŒ¿åè·¯ç”±çš„ç«¥é‹æ— æ³•ä½¿ç”¨<code>keep-alive</code>ã€‚ä¸è¿‡ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨<code>beforeRouteLeave</code>ç›‘å¬ï¼Œè‡ªå·±åšç¼“å­˜ï¼Œä¸è¿‡ç›®å‰æˆ‘è¿˜æ²¡è¯•è¿‡ï¼Œåç»­æˆ‘è¯•å®Œä¼šæ–°å†™çš„ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¸Œæœ›æœ¬æ–‡çš„å†…å®¹å¯¹å¤§å®¶çš„å­¦ä¹ æˆ–è€…å·¥ä½œå…·æœ‰ä¸€å®šçš„å‚è€ƒå­¦ä¹ ä»·å€¼ï¼Œå¦‚æœæœ‰ç–‘é—®å¤§å®¶å¯ä»¥ç•™è¨€äº¤æµï¼Œè°¢è°¢å¤§å®¶å¯¹æˆ‘çš„æ”¯æŒã€‚ğŸ˜˜âœ”</p>\n","more":"<h2 id=\"æ¦‚å¿µ\"><a href=\"#æ¦‚å¿µ\" class=\"headerlink\" title=\"æ¦‚å¿µ\"></a>æ¦‚å¿µ</h2><ul>\n<li><code>keep-alive</code><ul>\n<li><code>keep-alive</code>åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚å’Œ<code>transition</code>ç›¸ä¼¼ï¼Œ<code>keep-alive</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª<code>DOM</code>å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ã€‚</li>\n<li><a href=\"https://cn.vuejs.org/v2/api/#keep-alive\">keep-alive: vueæ–‡æ¡£</a></li>\n</ul>\n</li>\n<li>ç»„ä»¶å†…çš„å®ˆå«-<code>beforeRouteLeave</code><ul>\n<li>å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</li>\n<li>å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹<code>this</code></li>\n<li><a href=\"https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E7%BB%84%E4%BB%B6%E5%86%85%E7%9A%84%E5%AE%88%E5%8D%AB\">ç»„ä»¶å†…çš„å®ˆå«:<code>vue-router</code>æ–‡æ¡£</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"å‰è¨€\"><a href=\"#å‰è¨€\" class=\"headerlink\" title=\"å‰è¨€\"></a>å‰è¨€</h2><p>åå°ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå·¦ä¾§ä¸ºåŠŸèƒ½èœå•æ ï¼Œç‚¹å‡»èœå•åˆ—è¡¨ï¼Œå³ä¾§æ˜¾ç¤ºè¯¥èœå•çš„åŠŸèƒ½é¡µé¢ï¼Œæœ¬æ¥æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„åå°ç®¡ç†ç³»ç»Ÿå¸ƒå±€ï¼Œç°åœ¨å¢åŠ äº†tabsèœå•æŒ‰é’®ï¼›<br>ç‚¹å‡»å·¦ä¾§èœå•æ æ—¶ï¼Œå³ä¾§é¡µé¢å¤´éƒ¨headeræ˜¾ç¤ºå½“å‰çš„é¡µé¢æ ‡é¢˜ï¼Œå½¢æˆä¸€ä¸ªtabsåˆ—è¡¨ï¼Œç‚¹å‡»å¯åˆ‡æ¢é¡µé¢å†…å®¹å’Œå…³é—­tabï¼›<br>ç°åœ¨çš„éœ€æ±‚ï¼š<br>  æ‰“å¼€ä¹‹åéœ€è¦ä¿ç•™çš„é¡µé¢åœ¨tabä¸å…³é—­çš„æƒ…å†µä¸‹ï¼Œä¿ç•™ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œè€Œåœ¨tabå…³é—­ä¹‹åï¼Œåˆ™ä¸‹æ¬¡æ‰“å¼€ä¼šé‡æ–°è¯·æ±‚æ•°æ®ï¼Œä¸ä¼šä¿ç•™ä¸Šæ¬¡çŠ¶æ€ã€‚</p>\n<p>  <img src=\"/img/2020/01/vue/15794851288763.png\"></p>\n<h2 id=\"åˆæ­¥è§£å†³\"><a href=\"#åˆæ­¥è§£å†³\" class=\"headerlink\" title=\"åˆæ­¥è§£å†³\"></a>åˆæ­¥è§£å†³</h2><p>ç¬¬ä¸€æƒ³åˆ°çš„å°±æ˜¯åˆ©ç”¨vueçš„åŠŸèƒ½ç»„ä»¶</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;keep-alive&gt;</span><br><span class=\"line\">    &lt;router-view /&gt;</span><br><span class=\"line\">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>\n<p>ä½†æ˜¯è¿™ç§æƒ…å†µåªèƒ½å®ç°ç¼“å­˜æ‰€æœ‰é¡µé¢ï¼Œå°±æ˜¯ä¸èƒ½æ ¹æ®éœ€æ±‚å®ç°åŠ¨æ€ç¼“å­˜ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½å­˜ç€å‘¢ï¼Œæ„å•Šã€‚</p>\n<h2 id=\"è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\"><a href=\"#è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\" class=\"headerlink\" title=\"è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š\"></a>è§£å†³æ–¹æ¡ˆæ„æƒ³ï¼š</h2><blockquote>\n<p>è·¯ç”±å…ƒä¿¡æ¯å†…æ·»åŠ ç‰¹å®šå­—æ®µå¦‚ï¼š<code>keepAlive</code></p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const router = new VueRouter(&#123;</span><br><span class=\"line\">  routes: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      path: &#x27;/foo&#x27;,</span><br><span class=\"line\">      component: Foo,</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">          path: &#x27;bar&#x27;,</span><br><span class=\"line\">          component: Bar,</span><br><span class=\"line\">          // a meta field</span><br><span class=\"line\">          meta: &#123;</span><br><span class=\"line\">            keepAlive: true</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>çˆ¶ç»„ä»¶å†…æ ¹æ®è·¯ç”±ä¸­çš„<code>keepAlive</code>å­—æ®µåŠ¨æ€ä½¿ç”¨<code>keep-alive</code>æ ‡ç­¾</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">Vue</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    get keepAlive () &#123;</span><br><span class=\"line\">      <span class=\"comment\">// è·å–å½“å‰è·¯ç”±çš„å…ƒä¿¡æ¯ä¸­çš„keepAliveå­—æ®µ</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">$route</span>.<span class=\"property\">meta</span>.<span class=\"property\">keepAlive</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    private render () &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (</span><br><span class=\"line\">        <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">            !this.keepAlive &amp;&amp; <span class=\"tag\">&lt;<span class=\"name\">router-view</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">          &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;<span class=\"name\">keep-alive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#123;</span></span><br><span class=\"line\"><span class=\"language-xml\">              this.keepAlive &amp;&amp; <span class=\"tag\">&lt;<span class=\"name\">router-view</span>/&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            &#125;</span></span><br><span class=\"line\"><span class=\"language-xml\">          <span class=\"tag\">&lt;/<span class=\"name\">keep-alive</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Home</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€è·¯\"><a href=\"#æ€è·¯\" class=\"headerlink\" title=\"æ€è·¯\"></a>æ€è·¯</h2><p>ç”±äºç°åœ¨ç»„ä»¶çš„<code>keep-alive</code>æ˜¯åŠ¨æ€æ ¹æ®è·¯ç”±å…ƒä¿¡æ¯ä¸­çš„<code>keepAlive</code>å­—æ®µè¿›è¡ŒåŠ¨æ€ä½¿ç”¨çš„ï¼Œæ‰€ä»¥åªè¦åŠ¨æ€æ”¹å˜å¯¹åº”è·¯ç”±å…ƒä¿¡æ¯çš„<code>keepAlive</code>å­—æ®µå°±å¯ä»¥å®ç°åŠ¨æ€ç¼“å­˜ã€‚</p>\n<h2 id=\"å®ç°æ–¹æ¡ˆ\"><a href=\"#å®ç°æ–¹æ¡ˆ\" class=\"headerlink\" title=\"å®ç°æ–¹æ¡ˆ\"></a>å®ç°æ–¹æ¡ˆ</h2><h3 id=\"æ–¹æ¡ˆä¸€\"><a href=\"#æ–¹æ¡ˆä¸€\" class=\"headerlink\" title=\"æ–¹æ¡ˆä¸€\"></a>æ–¹æ¡ˆä¸€</h3><p>åˆ©ç”¨<code>beforeRouteLeave</code>æ”¹å˜<code>from</code>çš„<code>keepAlive</code>å®ç°ï¼ˆåŸæ€è·¯ï¼Œç½‘ç»œè§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œæœ‰bugï¼‰</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteLeave (to: any, from: any, next: any) &#123;</span><br><span class=\"line\">  // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</span><br><span class=\"line\">  // åˆ¤æ–­æ˜¯å¦æ˜¯å»å¾€é¡µé¢ C</span><br><span class=\"line\">  if (to.name !== &#x27;C&#x27;) &#123;</span><br><span class=\"line\">    // ä¸æ˜¯å» C é¡µé¢ï¼Œä¸ç¼“å­˜</span><br><span class=\"line\">    from.meta.keepAlive = false</span><br><span class=\"line\">  &#125; else &#123;</span><br><span class=\"line\">    // æ˜¯å» C é¡µé¢ï¼Œç¼“å­˜</span><br><span class=\"line\">    from.meta.keepAlive = true</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  next()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>bugï¼šé¦–æ¬¡å»Cé¡µé¢ï¼Œå†è¿”å›Bé¡µé¢ï¼ŒBå¹¶æ²¡æœ‰ç¼“å­˜ï¼Œç¬¬äºŒæ¬¡å†è¿›å…¥Cé¡µé¢ï¼ŒBé¡µé¢ç¼“å­˜ï¼Œä¸”è¿›Aé¡µé¢å¹¶ä¸èƒ½æ¸…é™¤Bé¡µé¢çš„ç¼“å­˜</p>\n</blockquote>\n<h3 id=\"æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"><a href=\"#æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"></a>æ–¹æ¡ˆäºŒï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰</h3><p><code>$destroy()</code>é”€æ¯</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beforeRouteLeave (to: any, from: any, next: any) &#123;</span><br><span class=\"line\">  // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨</span><br><span class=\"line\">  // åˆ¤æ–­æ˜¯å¦æ˜¯å»å¾€é¡µé¢ C</span><br><span class=\"line\">  if (to.name !== &#x27;C&#x27;) &#123;</span><br><span class=\"line\">    // ä¸æ˜¯å» C é¡µé¢ï¼Œä¸ç¼“å­˜</span><br><span class=\"line\">    this.$destroy()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  next()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>bugï¼šé”€æ¯ä¹‹åæ°¸è¿œä¸ä¼šè¢«ç¼“å­˜</p>\n</blockquote>\n<h3 id=\"æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"><a href=\"#æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰\"></a>æ–¹æ¡ˆä¸‰ï¼ˆç½‘ç»œæ–¹æ¡ˆï¼‰</h3><ul>\n<li>æ ¹æ®æºç çœ‹æ¥ç¼“å­˜çš„ç»„ä»¶éƒ½ä¼šè®¾ç½®ä¸€ä¸ªcacheå±æ€§ï¼Œå¯ä»¥é€šè¿‡ä»£ç å¼ºè¡Œç§»é™¤æ‰ã€‚ç¼ºç‚¹å°±æ˜¯æ²¡æœ‰å½»åº•é”€æ¯ä¾æ—§å å†…å­˜</li>\n<li><a href=\"https://segmentfault.com/a/1190000015845117\">å…·ä½“å®ç°å‚è€ƒ</a></li>\n</ul>\n<h3 id=\"æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\"><a href=\"#æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\" class=\"headerlink\" title=\"æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰\"></a>æ–¹æ¡ˆå››ï¼ˆæœ€ä¼˜è§£ï¼‰</h3><p>åˆ©ç”¨<code>keep-alive</code>çš„<code>include</code>å±æ€§ï¼Œåˆ©ç”¨<code>vuex</code>åŠ¨æ€æ§åˆ¶<code>include</code>è¾¾åˆ°åŠ¨æ€ç®¡ç†ç¼“å­˜</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;keep-alive :include=&quot;keepAliveList&quot;&gt;</span><br><span class=\"line\">    &lt;router-view :key=&quot;$route.fullPath&quot;/&gt;</span><br><span class=\"line\">&lt;/keep-alive&gt;</span><br></pre></td></tr></table></figure>\n\n<p>åˆ©ç”¨è®¡ç®—å±æ€§å’Œvuexè·å–ç¼“å­˜åˆ—è¡¨</p>\n<blockquote>\n<p>è¿™é‡Œå¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„è§„åˆ™ï¼ŒåŸå› è¯·ç»§ç»­å¾€ä¸‹çœ‹</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!--vuex--&gt;</span><br><span class=\"line\">state: &#123;</span><br><span class=\"line\">    keepAliveList:&#x27;&#x27;,//ä¿å­˜ç¼“å­˜çš„åˆ—è¡¨</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">mutations: &#123;</span><br><span class=\"line\">    setKeepAliveLists(state,arrListString)&#123;</span><br><span class=\"line\">        state.keepAliveList = arrListString;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--è§†å›¾ç»„ä»¶ä¸­--&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">computed:&#123;</span><br><span class=\"line\">    keepAliveList()&#123;</span><br><span class=\"line\">        // è·å–ç¼“å­˜çš„è·¯ç”±åˆ—è¡¨</span><br><span class=\"line\">        return this.$store.state.keepAliveList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç”Ÿæˆç¼“å­˜åˆ—è¡¨ï¼Œåˆ—è¡¨çš„å€¼ä¸ºå„ç»„ä»¶ä¸­nameçš„å€¼é›†åˆæ‹¼æ¥çš„å­—ç¬¦ä¸²</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">this.$store.commit(&#x27;setKeepAliveLists&#x27;,routerComponentNameList.join())</span><br></pre></td></tr></table></figure>\n\n<p>ç‚¹å‡»å·¦ä¾§èœå•æ æ—¶ï¼Œæ›´æ–°ç¼“å­˜åˆ—è¡¨</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- ç‚¹å‡»å·¦ä¾§èœå•çš„äº‹ä»¶å‡½æ•° --&gt;</span><br><span class=\"line\">handleSelect(name) &#123;</span><br><span class=\"line\">    if(this.routerNameMap.has(name))&#123;//å¦‚æœå½“å‰ç‚¹å‡»çš„è·¯ç”±å·²ç»åœ¨ç¼“å­˜åˆ—è¡¨ä¸­ï¼Œåˆ™å…ˆæ¸…é™¤ç¼“å­˜åˆ—è¡¨ï¼Œå†æ·»åŠ ï¼›</span><br><span class=\"line\">        this.resetKeepAive(name,this.keepAliveList);//åˆ é™¤ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">        this.tabChangeRoute(name);//åˆ‡æ¢è·¯ç”±</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        this.routerNameMap.add(name)</span><br><span class=\"line\">        this.tabChangeRoute(name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">// æ›´æ–°è¦ç¼“å­˜çš„è·¯ç”±åˆ—è¡¨</span><br><span class=\"line\">resetKeepAive(name,cacheList) &#123;</span><br><span class=\"line\">    const conf = this.keepAliveList;</span><br><span class=\"line\">    let arr = cacheList.split(&#x27;,&#x27;);</span><br><span class=\"line\">    if (name &amp;&amp; typeof name === &#x27;string&#x27;) &#123;</span><br><span class=\"line\">        let i = arr.indexOf(name);</span><br><span class=\"line\">        if (i &gt; -1) &#123;</span><br><span class=\"line\">            arr.splice(i, 1);</span><br><span class=\"line\">            this.$store.commit(&#x27;setKeepAliveLists&#x27;,arr.join());</span><br><span class=\"line\">            this.$nextTick(() =&gt; &#123;//æ·»åŠ ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">                this.$store.commit(&#x27;setKeepAliveLists&#x27;,conf);</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ç‚¹å‡»å³ä¾§tabså…³é—­æ ‡ç­¾åˆ é™¤ç¼“å­˜</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">removeTab(name)&#123;</span><br><span class=\"line\">    // ç‚¹å‡»tabä¸Šçš„å…³é—­æŒ‰é’®ï¼Œæ¸…é™¤å½“å‰è·¯ç”±çš„ç¼“å­˜</span><br><span class=\"line\">    this.routerNameMap.delete(name);</span><br><span class=\"line\">    this.resetKeepAive(name,this.keepAliveList);//åˆ é™¤ç¼“å­˜è·¯ç”±</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ä¸‹é¢ä¸ºä¸»è¦ä»£ç ï¼Œç›‘å¬å½“å‰è·¯ç”±æ˜¯å¦è¢«ç§»é™¤ç¼“å­˜ï¼Œå¦‚æœç§»é™¤ç¼“å­˜åˆ™éœ€è¦é”€æ¯è¯¥ç»„ä»¶ï¼Œå¦åˆ™å†…å®¹ä¸­çš„ç¼“å­˜ç»„ä»¶ä¼šè¶Šæ¥è¶Šæ¥ï¼Œå½±å“ä½¿ç”¨æ€§èƒ½ï¼›<br>åˆ›å»ºä¸€ä¸ª<code>mixin.js</code>æ–‡ä»¶ï¼Œç„¶åå¼•å…¥åˆ°éœ€è¦è¢«åŠ¨æ€ç¼“å­˜çš„è·¯ç”±ç»„ä»¶ä¸­å³å¯ï¼›</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// è·¯ç”±ç¼“å­˜ç®¡ç†</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">    computed: &#123;</span><br><span class=\"line\">        keepAliveConf()&#123;</span><br><span class=\"line\">            return this.$store.state.keepAliveList;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    watch:&#123;</span><br><span class=\"line\">        keepAliveConf(e)&#123;</span><br><span class=\"line\">            // ç›‘å¬ç¼“å­˜åˆ—è¡¨çš„å˜åŒ–ï¼Œå¦‚æœç¼“å­˜åˆ—è¡¨ä¸­æ²¡æœ‰å½“å‰çš„è·¯ç”±æˆ–ç»„ä»¶åˆ™åœ¨ç¼“å­˜ä¸­é”€æ¯è¯¥å®ä¾‹</span><br><span class=\"line\">            let name = this.$options.name;</span><br><span class=\"line\">            if(!e.split(&#x27;,&#x27;).includes(name)) &#123;</span><br><span class=\"line\">                this.$destroy()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å…³äºåœ¨<code>$store</code>ä¸­ä¿å­˜å’Œåˆ é™¤çš„è¿‡ç¨‹ï¼Œå„äººæœ‰å„äººçš„æ–¹æ³•ï¼Œæˆ‘è¿™è¾¹åªæ˜¯ä¸€ç§å‚è€ƒï¼Œä¸è¿‡å¤šè®¨è®ºã€‚</p>\n<p>ä¸è¿‡å…³äº<code>keep-alive</code>çš„<code>include</code>åŸç†ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸‹ï¼Œå®˜æ–¹(æˆªæ­¢åˆ°2020å¹´1æœˆ)ç»™çš„æ–¹æ¡ˆæ˜¯æ­£åˆ™ç™½åå•ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨<code>include</code>ä¸­åŒ…å«çš„å­—æ®µï¼Œåªè¦è·¯ç”±çš„<code>name</code>æ»¡è¶³æ­£åˆ™è¦æ±‚ï¼Œåˆ™ä¼šç¼“å­˜ï¼Œ<code>exclude</code>çš„è§„åˆ™åŒæ ·æ»¡è¶³ï¼Œæ‰€ä»¥è¿™å°±é€ æˆåŒ¿åè·¯ç”±çš„ç«¥é‹æ— æ³•ä½¿ç”¨<code>keep-alive</code>ã€‚ä¸è¿‡ä¹Ÿæœ‰è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨<code>beforeRouteLeave</code>ç›‘å¬ï¼Œè‡ªå·±åšç¼“å­˜ï¼Œä¸è¿‡ç›®å‰æˆ‘è¿˜æ²¡è¯•è¿‡ï¼Œåç»­æˆ‘è¯•å®Œä¼šæ–°å†™çš„ã€‚</p>\n<p>ä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¸Œæœ›æœ¬æ–‡çš„å†…å®¹å¯¹å¤§å®¶çš„å­¦ä¹ æˆ–è€…å·¥ä½œå…·æœ‰ä¸€å®šçš„å‚è€ƒå­¦ä¹ ä»·å€¼ï¼Œå¦‚æœæœ‰ç–‘é—®å¤§å®¶å¯ä»¥ç•™è¨€äº¤æµï¼Œè°¢è°¢å¤§å®¶å¯¹æˆ‘çš„æ”¯æŒã€‚ğŸ˜˜âœ”</p>\n","categories":[{"name":"æ•™ç¨‹åˆ†äº«","path":"api/categories/æ•™ç¨‹åˆ†äº«.json"},{"name":"Vue","path":"api/categories/Vue.json"}],"tags":[{"name":"Vue","path":"api/tags/Vue.json"}]}