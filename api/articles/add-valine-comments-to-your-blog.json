{"title":"Hexo优化-Hexo评论插件","slug":"add-valine-comments-to-your-blog","date":"2018-04-29T16:00:00.000Z","updated":"2022-10-19T14:40:00.238Z","comments":true,"path":"api/articles/add-valine-comments-to-your-blog.json","realPath":"/2018/add-valine-comments-to-your-blog/index/","excerpt":" [Figure] ","covers":["/img/006qRazegy1flcucgbhmuj30sf0o3mxy.jpg","https://ws1.sinaimg.cn/large/006qRazegy1fibactm2csj30x80f2dhn.jpg","https://ws1.sinaimg.cn/large/006qRazegy1fiba67warvj30re0k5abv.jpg","https://ws1.sinaimg.cn/large/006qRazegy1fibb4pbvv4j31820iqjw0.jpg","/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-45-11.png","/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-43-52.png","/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-46-35.png","/img/ping-mu-kuai-zhao-2017-08-15-xia-wu-6-30-12.png","/img/ping-mu-kuai-zhao-2017-08-14-xia-wu-5-48-25.png","/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-57-13.png","/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-52-48.png"],"cover":"/img/006qRazegy1flcucgbhmuj30sf0o3mxy.jpg","content":"<p><img src=\"/img/006qRazegy1flcucgbhmuj30sf0o3mxy.jpg\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"写在前面的\"><a href=\"#写在前面的\" class=\"headerlink\" title=\"写在前面的\"></a>写在前面的</h2><p>2017年6月1日，在你等超龄儿童欢度节日的时候，多说躺下了。<br>2017年8月1日，不甘寂寞的网易云跟帖也跟多说随风而去了。</p>\n<p>2017年8月7日，一款基于<code>Leancloud</code>的极简风评论系统诞生：<a href=\"https://valine.js.org/\">Valine</a>。</p>\n<h2 id=\"食用方法\"><a href=\"#食用方法\" class=\"headerlink\" title=\"食用方法\"></a>食用方法</h2><h3 id=\"获取-APP-ID-和-APP-KEY\"><a href=\"#获取-APP-ID-和-APP-KEY\" class=\"headerlink\" title=\"获取 APP ID 和 APP KEY\"></a>获取 <code>APP ID</code> 和 <code>APP KEY</code></h3><ol>\n<li><a href=\"https://leancloud.cn/dashboard/login.html#/signup\">点击这里登录或注册</a><code>Leancloud</code></li>\n<li><a href=\"https://leancloud.cn/dashboard/applist.html#/newapp\">点这里创建应用</a>，应用名看个人喜好。</li>\n<li>选择刚刚创建的<code>应用</code>&gt;<code>设置</code>&gt;选择<code>应用 Key</code>，然后你就能看到你的<code>APP ID</code>和<code>APP KEY</code>了，参考下图：</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fibactm2csj30x80f2dhn.jpg\"></p>\n<ol start=\"4\">\n<li>为了您的数据安全，请填写<code>应用</code>&gt;<code>设置</code>&gt;<code>安全设置</code>中的<code>Web 安全域名</code>，如下图：</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fiba67warvj30re0k5abv.jpg\"></p>\n<h3 id=\"页面中的设置\"><a href=\"#页面中的设置\" class=\"headerlink\" title=\"页面中的设置\"></a>页面中的设置</h3><p>页面中的食用方法炒鸡简单，来来来，我们用代码说话：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Valine - A simple comment system based on Leancloud.<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Leancloud 操作库:--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;//cdn1.lncld.net/static/js/3.0.4/av-min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Valine 的核心代码库:--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./dist/Valine.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;comment&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Valine</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// AV 对象来自上面引入av-min.js(老司机们不要开车➳♡゛扎心了老铁)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">av</span>: <span class=\"variable constant_\">AV</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;.comment&#x27;</span>, <span class=\"comment\">//</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">app_id</span>: <span class=\"string\">&#x27;Your APP ID&#x27;</span>, <span class=\"comment\">// 这里填写上面得到的APP ID</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">app_key</span>: <span class=\"string\">&#x27;Your APP KEY&#x27;</span>, <span class=\"comment\">// 这里填写上面得到的APP KEY</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">placeholder</span>: <span class=\"string\">&#x27;ヾﾉ≧∀≦)o来啊，快活啊!&#x27;</span> <span class=\"comment\">// [v1.0.7 new]留言框占位提示文字</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Valine.min.js</code> 你可以使用别人的或者上传到自己的服务器或主机：<a href=\"https://github.com/panjunwen/Valine/releases/tag/v1.1.4.fix\">Valine Ex</a></p>\n<p>需要修改的只有：<code>el</code>、<code>app_id</code> 和 <code>app_key</code>。如果之前有用原版<code>Valine</code>，请将邮件通知和验证码关掉：<code>notify: false</code>, <code>verify: false</code>，避免重复发通知。算术验证码反人类，强烈建议停用。<br>此外，如果你的主题没有引入 <code>jQuery</code> 也请引入。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;https://cdnjs.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>至此，你的评论系统已经可以工作了！是不是很简单😉.</p>\n<p>看吧，我是不是没说大话(<code>_(:з」∠)_一本正经的胡说八道</code>)。</p>\n<h3 id=\"评论数据管理\"><a href=\"#评论数据管理\" class=\"headerlink\" title=\"评论数据管理\"></a>评论数据管理</h3><p>插播一下，关于评论数据管理，请自行登录<code>Leancloud</code>应用管理。<br>具体步骤：<code>登录</code>&gt;选择你创建的<code>应用</code>&gt;<code>存储</code>&gt;选择<code>ClassComment</code>，然后就可以尽情的发挥你的权利啦(～￣▽￣)～</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fibb4pbvv4j31820iqjw0.jpg\"></p>\n<h2 id=\"自定义Hexo评论\"><a href=\"#自定义Hexo评论\" class=\"headerlink\" title=\"自定义Hexo评论\"></a>自定义Hexo评论</h2><blockquote>\n<p>转自:<a href=\"http://panjunwen.com/\">panjunwen.com</a></p>\n</blockquote>\n<h3 id=\"云引擎一键部署\"><a href=\"#云引擎一键部署\" class=\"headerlink\" title=\"云引擎一键部署\"></a>云引擎一键部署</h3><p>虽然 Valine 是无后端的，但为了实现邮件通知和垃圾评论过滤，需要部署少量的 LeanEngine 代码。不用担心，代码我都写好了，不需要本地开发环境，只要在网页点两下就能完成。关于自动休眠问题的说明。</p>\n<ol>\n<li>打开 <a href=\"https://leancloud.cn/dashboard/#/apps\">LeanCloud 后台</a>，进入云引擎设置页。</li>\n</ol>\n<ul>\n<li>填写代码库并保存：<code>https://github.com/panjunwen/Valine-Admin.git</code></li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-45-11.png\"></p>\n<ul>\n<li>切换到部署标签页，分支使用master，点击部署即可：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-43-52.png\"></p>\n<ol start=\"2\">\n<li>此外，你需要设置云引擎的环境变量以提供必要的信息，如下示例：</li>\n</ol>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-46-35.png\"></p>\n<p>请正确填写 SMTP 服务器信息，部分邮箱需要单独的 SMTP 密码。以QQ邮箱为例，需要在设置中开启 SMTP 并且通过发送短信来获取授权码（即密码）。注意我们使用 SSL 发件，所以端口别填错了。</p>\n<p>如果你用过 WordPress 你应该有 Akismet Key；如果还没有，你可以去 <a href=\"https://akismet.com/development/\">AKISMET FOR DEVELOPERS</a> 网站 免费申请一个；如果你不需要反垃圾评论，Akismet Key可以忽略。</p>\n<ol start=\"3\">\n<li>设置二级域名后你可以访问评论管理后台。</li>\n</ol>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-08-15-xia-wu-6-30-12.png\"></p>\n<p>后台管理需要登录，__使用云存储 _User 表中的用户登录即可__。特别提醒，为确保数据安全，请合理设置数据库权限。此外，请务必设置 Web 安全域名。</p>\n<ol start=\"4\">\n<li>设置完成后重启一下云引擎实例一切就正常工作啦！</li>\n</ol>\n<h3 id=\"数据迁移\"><a href=\"#数据迁移\" class=\"headerlink\" title=\"数据迁移\"></a>数据迁移</h3><p><a href=\"http://disqus.panjunwen.com/\">Disqus2LeanCloud</a><br>（点击提交按钮后跳转至博客首页，大约一两分钟会自动导入完成。）</p>\n<h3 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h3><ul>\n<li>前端效果：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-08-14-xia-wu-5-48-25.png\"></p>\n<ul>\n<li>后台截图：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-57-13.png\"></p>\n<ul>\n<li>邮件通知：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-52-48.png\"></p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>Valine 『无后端』已经可以很好的运行，但反垃圾评论和邮件通知还得靠后台来做，正好 LeanCloud 提供免费的云引擎和云 Hook，得以实现上述功能。LeanCloud 实在太好用了，借助官方的示例程序，连 JavaScript 语法都不懂就硬着头皮用 Nodejs 了，代码虽然很丑还是放出来，Github：<a href=\"https://github.com/panjunwen/Valine-Admin\">Valine-Admin</a>。另外数据迁移是用 Flask 写的，也是第一次用，所以就不放源码献丑了。</p>\n<p>关于免费云引擎自动休眠的补充说明：<br>关于自动休眠的官方说法：<a href=\"https://leancloud.cn/docs/leanengine_plan.html#hash633315134\">点击查看</a>；休眠后只影响邮件通知功能，可以在评论管理后台补发。<br>我的做法是在 VPS 上添加一个定时任务，每天6:00 ~ 23:00每20分钟访问一次我的leanapp网址，防止云引擎进入休眠，保证通知邮件的及时发送。cron定时任务：<code>*/20 6-23 * * * curl https://deserts.leanapp.cn</code>。薅羊毛就要薅得干干净净！</p>\n<hr>\n<blockquote>\n<p>更多配置信息请移步：<a href=\"https://valine.js.org/\">https://valine.js.org</a></p>\n</blockquote>\n","more":"<h2 id=\"写在前面的\"><a href=\"#写在前面的\" class=\"headerlink\" title=\"写在前面的\"></a>写在前面的</h2><p>2017年6月1日，在你等超龄儿童欢度节日的时候，多说躺下了。<br>2017年8月1日，不甘寂寞的网易云跟帖也跟多说随风而去了。</p>\n<p>2017年8月7日，一款基于<code>Leancloud</code>的极简风评论系统诞生：<a href=\"https://valine.js.org/\">Valine</a>。</p>\n<h2 id=\"食用方法\"><a href=\"#食用方法\" class=\"headerlink\" title=\"食用方法\"></a>食用方法</h2><h3 id=\"获取-APP-ID-和-APP-KEY\"><a href=\"#获取-APP-ID-和-APP-KEY\" class=\"headerlink\" title=\"获取 APP ID 和 APP KEY\"></a>获取 <code>APP ID</code> 和 <code>APP KEY</code></h3><ol>\n<li><a href=\"https://leancloud.cn/dashboard/login.html#/signup\">点击这里登录或注册</a><code>Leancloud</code></li>\n<li><a href=\"https://leancloud.cn/dashboard/applist.html#/newapp\">点这里创建应用</a>，应用名看个人喜好。</li>\n<li>选择刚刚创建的<code>应用</code>&gt;<code>设置</code>&gt;选择<code>应用 Key</code>，然后你就能看到你的<code>APP ID</code>和<code>APP KEY</code>了，参考下图：</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fibactm2csj30x80f2dhn.jpg\"></p>\n<ol start=\"4\">\n<li>为了您的数据安全，请填写<code>应用</code>&gt;<code>设置</code>&gt;<code>安全设置</code>中的<code>Web 安全域名</code>，如下图：</li>\n</ol>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fiba67warvj30re0k5abv.jpg\"></p>\n<h3 id=\"页面中的设置\"><a href=\"#页面中的设置\" class=\"headerlink\" title=\"页面中的设置\"></a>页面中的设置</h3><p>页面中的食用方法炒鸡简单，来来来，我们用代码说话：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"keyword\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">&quot;en&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Valine - A simple comment system based on Leancloud.<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Leancloud 操作库:--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;//cdn1.lncld.net/static/js/3.0.4/av-min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--Valine 的核心代码库:--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;./dist/Valine.min.js&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;comment&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"language-javascript\"></span></span><br><span class=\"line\"><span class=\"language-javascript\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Valine</span>(&#123;</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"comment\">// AV 对象来自上面引入av-min.js(老司机们不要开车➳♡゛扎心了老铁)</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">av</span>: <span class=\"variable constant_\">AV</span>,</span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">el</span>: <span class=\"string\">&#x27;.comment&#x27;</span>, <span class=\"comment\">//</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">app_id</span>: <span class=\"string\">&#x27;Your APP ID&#x27;</span>, <span class=\"comment\">// 这里填写上面得到的APP ID</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">app_key</span>: <span class=\"string\">&#x27;Your APP KEY&#x27;</span>, <span class=\"comment\">// 这里填写上面得到的APP KEY</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">            <span class=\"attr\">placeholder</span>: <span class=\"string\">&#x27;ヾﾉ≧∀≦)o来啊，快活啊!&#x27;</span> <span class=\"comment\">// [v1.0.7 new]留言框占位提示文字</span></span></span><br><span class=\"line\"><span class=\"language-javascript\">        &#125;);</span></span><br><span class=\"line\"><span class=\"language-javascript\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>Valine.min.js</code> 你可以使用别人的或者上传到自己的服务器或主机：<a href=\"https://github.com/panjunwen/Valine/releases/tag/v1.1.4.fix\">Valine Ex</a></p>\n<p>需要修改的只有：<code>el</code>、<code>app_id</code> 和 <code>app_key</code>。如果之前有用原版<code>Valine</code>，请将邮件通知和验证码关掉：<code>notify: false</code>, <code>verify: false</code>，避免重复发通知。算术验证码反人类，强烈建议停用。<br>此外，如果你的主题没有引入 <code>jQuery</code> 也请引入。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script src=&quot;https://cdnjs.cat.net/ajax/libs/jquery/3.2.1/jquery.min.js&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p>至此，你的评论系统已经可以工作了！是不是很简单😉.</p>\n<p>看吧，我是不是没说大话(<code>_(:з」∠)_一本正经的胡说八道</code>)。</p>\n<h3 id=\"评论数据管理\"><a href=\"#评论数据管理\" class=\"headerlink\" title=\"评论数据管理\"></a>评论数据管理</h3><p>插播一下，关于评论数据管理，请自行登录<code>Leancloud</code>应用管理。<br>具体步骤：<code>登录</code>&gt;选择你创建的<code>应用</code>&gt;<code>存储</code>&gt;选择<code>ClassComment</code>，然后就可以尽情的发挥你的权利啦(～￣▽￣)～</p>\n<p><img src=\"https://ws1.sinaimg.cn/large/006qRazegy1fibb4pbvv4j31820iqjw0.jpg\"></p>\n<h2 id=\"自定义Hexo评论\"><a href=\"#自定义Hexo评论\" class=\"headerlink\" title=\"自定义Hexo评论\"></a>自定义Hexo评论</h2><blockquote>\n<p>转自:<a href=\"http://panjunwen.com/\">panjunwen.com</a></p>\n</blockquote>\n<h3 id=\"云引擎一键部署\"><a href=\"#云引擎一键部署\" class=\"headerlink\" title=\"云引擎一键部署\"></a>云引擎一键部署</h3><p>虽然 Valine 是无后端的，但为了实现邮件通知和垃圾评论过滤，需要部署少量的 LeanEngine 代码。不用担心，代码我都写好了，不需要本地开发环境，只要在网页点两下就能完成。关于自动休眠问题的说明。</p>\n<ol>\n<li>打开 <a href=\"https://leancloud.cn/dashboard/#/apps\">LeanCloud 后台</a>，进入云引擎设置页。</li>\n</ol>\n<ul>\n<li>填写代码库并保存：<code>https://github.com/panjunwen/Valine-Admin.git</code></li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-45-11.png\"></p>\n<ul>\n<li>切换到部署标签页，分支使用master，点击部署即可：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-43-52.png\"></p>\n<ol start=\"2\">\n<li>此外，你需要设置云引擎的环境变量以提供必要的信息，如下示例：</li>\n</ol>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-46-35.png\"></p>\n<p>请正确填写 SMTP 服务器信息，部分邮箱需要单独的 SMTP 密码。以QQ邮箱为例，需要在设置中开启 SMTP 并且通过发送短信来获取授权码（即密码）。注意我们使用 SSL 发件，所以端口别填错了。</p>\n<p>如果你用过 WordPress 你应该有 Akismet Key；如果还没有，你可以去 <a href=\"https://akismet.com/development/\">AKISMET FOR DEVELOPERS</a> 网站 免费申请一个；如果你不需要反垃圾评论，Akismet Key可以忽略。</p>\n<ol start=\"3\">\n<li>设置二级域名后你可以访问评论管理后台。</li>\n</ol>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-08-15-xia-wu-6-30-12.png\"></p>\n<p>后台管理需要登录，__使用云存储 _User 表中的用户登录即可__。特别提醒，为确保数据安全，请合理设置数据库权限。此外，请务必设置 Web 安全域名。</p>\n<ol start=\"4\">\n<li>设置完成后重启一下云引擎实例一切就正常工作啦！</li>\n</ol>\n<h3 id=\"数据迁移\"><a href=\"#数据迁移\" class=\"headerlink\" title=\"数据迁移\"></a>数据迁移</h3><p><a href=\"http://disqus.panjunwen.com/\">Disqus2LeanCloud</a><br>（点击提交按钮后跳转至博客首页，大约一两分钟会自动导入完成。）</p>\n<h3 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h3><ul>\n<li>前端效果：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-08-14-xia-wu-5-48-25.png\"></p>\n<ul>\n<li>后台截图：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-57-13.png\"></p>\n<ul>\n<li>邮件通知：</li>\n</ul>\n<p><img src=\"/img/ping-mu-kuai-zhao-2017-11-12-xia-wu-2-52-48.png\"></p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>Valine 『无后端』已经可以很好的运行，但反垃圾评论和邮件通知还得靠后台来做，正好 LeanCloud 提供免费的云引擎和云 Hook，得以实现上述功能。LeanCloud 实在太好用了，借助官方的示例程序，连 JavaScript 语法都不懂就硬着头皮用 Nodejs 了，代码虽然很丑还是放出来，Github：<a href=\"https://github.com/panjunwen/Valine-Admin\">Valine-Admin</a>。另外数据迁移是用 Flask 写的，也是第一次用，所以就不放源码献丑了。</p>\n<p>关于免费云引擎自动休眠的补充说明：<br>关于自动休眠的官方说法：<a href=\"https://leancloud.cn/docs/leanengine_plan.html#hash633315134\">点击查看</a>；休眠后只影响邮件通知功能，可以在评论管理后台补发。<br>我的做法是在 VPS 上添加一个定时任务，每天6:00 ~ 23:00每20分钟访问一次我的leanapp网址，防止云引擎进入休眠，保证通知邮件的及时发送。cron定时任务：<code>*/20 6-23 * * * curl https://deserts.leanapp.cn</code>。薅羊毛就要薅得干干净净！</p>\n<hr>\n<blockquote>\n<p>更多配置信息请移步：<a href=\"https://valine.js.org/\">https://valine.js.org</a></p>\n</blockquote>","categories":[{"name":"学习记录","path":"api/categories/学习记录.json"},{"name":"Hexo","path":"api/categories/Hexo.json"}],"tags":[{"name":"学习记录","path":"api/tags/学习记录.json"},{"name":"valine","path":"api/tags/valine.json"}]}